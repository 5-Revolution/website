let RECAPTCHA_SITE_KEY="6LcZlGcsAAAAADIVM3BRh3uOTaLDip6H4RNL-GM8";export default async function initializeForm(t){if("loaded"!==t.dataset.status){var{createElement:e,markLoaded:a}=await import("../../../scripts/app.js"),r=extractJsonUrl(t);if(r){var n=extractHeadingContent(t),i=parseColumnClass(t);showLoadingState(t);try{var l=await fetch(r,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error(`HTTP ${l.status}: `+l.statusText);renderForm(t,await l.json(),{createElement:e,colClass:i,headingContent:n}),a(t,"form")}catch(e){console.error(`Failed to load form from ${r}:`,e),showErrorState(t,e.message)}}else console.warn("Form component missing JSON URL")}}function extractJsonUrl(a){if(a.classList.contains("heading")){var r=[...a.children];if(r.length<2)return null;let e=r[1].querySelector("div"),t=e?.querySelector("a[href]");return t?t.getAttribute("href"):e?.querySelector("p")?.textContent?.trim()}let e=a.querySelector("div div");if(!e)return null;let t=e.querySelector("a[href]");return t?t.getAttribute("href"):e.querySelector("p")?.textContent?.trim()}function extractHeadingContent(e){return e.classList.contains("heading")&&!((e=[...e.children]).length<2)&&(e=e[0].querySelector("div"))?e.innerHTML:""}function parseColumnClass(e){e=[...e.classList].find(e=>/^lg-\d+$/.test(e));return e?"col-"+e:null}function showLoadingState(e){e.innerHTML='<div class="d-flex justify-content-center align-items-center py-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading form...</span></div><span class="ms-2">Loading form...</span></div>'}function showErrorState(e,t){e.innerHTML='<div class="alert alert-danger" role="alert"><h4 class="alert-heading">Error Loading Form</h4>'+`<p>${t}</p><hr>`+'<p class="mb-0">Please try again later or contact us directly.</p></div>'}function renderForm(e,r,{createElement:n,colClass:i,headingContent:l}){if(r&&r.fields){e.innerHTML="";var o=n("div",["container"]),d=n("div",["row","g-4"]),i=n("div",[i||"col-lg-7"]),l=(l&&((s=n("div",["mb-4"])).innerHTML=l,i.appendChild(s)),n("div",["form-wrapper"])),s={id:r.formId||"dynamic-form",novalidate:!0};!0!==r.recaptcha&&"true"!==r.recaptcha||(s["data-recaptcha"]="true");let t=n("form",["needs-validation"],s),a=n("div",["row","g-3"]);r.fields.forEach(e=>{"submit"===e.type?addSubmitButton(e,a,t,{createElement:n}):addFormField(e,a,{createElement:n})}),t.appendChild(a),setupFormValidation(t,r),l.appendChild(t),i.appendChild(l),d.appendChild(i),o.appendChild(d),e.appendChild(o)}else showErrorState(e,"Invalid form configuration")}function addFormField(e,t,{createElement:a}){var r,n=a("div",[e.halfWidth?"col-md-6":"col-12"]),i=a("div",["mb-0"]);"checkbox"!==e.type&&"radio"!==e.type&&e.label&&i.appendChild(createLabel(e,{createElement:a}));let l;switch(e.type){case"text":case"email":case"tel":case"url":case"number":case"password":l=createTextInput(e,{createElement:a});break;case"text-area":l=createTextArea(e,{createElement:a});break;case"select":l=createSelect(e,{createElement:a});break;case"checkbox":return addCheckbox(e,i,{createElement:a}),n.appendChild(i),void t.appendChild(n);case"radio":return addRadioGroup(e,i,{createElement:a}),n.appendChild(i),void t.appendChild(n);default:l=createTextInput(e,{createElement:a})}i.appendChild(l),e.mandatory&&((r=a("div",["invalid-feedback"])).textContent=e.validationMessage||`Please provide a valid ${e.label?.toLowerCase()||e.name}.`,i.appendChild(r)),e.helpText&&((r=a("div",["form-text"])).textContent=e.helpText,i.appendChild(r)),n.appendChild(i),t.appendChild(n)}function createLabel(e,{createElement:t}){t=t("label",["form-label"],{for:e.name});return e.mandatory?t.innerHTML=e.label+' <span class="required-mark">*</span>':t.innerHTML=e.label+' <span class="text-muted" style="font-weight: 400; font-size: 0.875rem;">(optional)</span>',t}function createTextInput(e,{createElement:t}){var a=["form-control"],r=(e.size&&a.push("form-control-"+e.size),{type:e.type,id:e.name,name:e.name}),t=(e.placeholder&&(r.placeholder=e.placeholder),e.mandatory&&(r.required=!0),t("input",a,r));return e.value&&(t.value=e.value),e.maxLength&&(t.maxLength=e.maxLength),e.minLength&&(t.minLength=e.minLength),e.pattern&&(t.pattern=e.pattern),t}function createTextArea(e,{createElement:t}){var a=["form-control"],r=(e.size&&a.push("form-control-"+e.size),{id:e.name,name:e.name,rows:e.rows||3}),t=(e.placeholder&&(r.placeholder=e.placeholder),e.mandatory&&(r.required=!0),t("textarea",a,r));return e.value&&(t.value=e.value),e.maxLength&&(t.maxLength=e.maxLength),t}function createSelect(e,{createElement:a}){var t=["form-select"],r=(e.size&&t.push("form-select-"+e.size),{id:e.name,name:e.name});e.mandatory&&(r.required=!0);let n=a("select",t,r);return e.placeholder&&((t=a("option",[],{value:""})).textContent=e.placeholder,n.appendChild(t)),e.options&&e.options.forEach(e=>{var t=a("option",[],{value:e.value||e.label});t.textContent=e.label,e.selected&&(t.selected=!0),n.appendChild(t)}),n}function addCheckbox(e,t,{createElement:a}){var r=a("div",["form-check"]),n={type:"checkbox",id:e.name,name:e.name,value:e.value||"1"},n=(e.mandatory&&(n.required=!0),a("input",["form-check-input"],n));r.appendChild(n),e.label&&((n=a("label",["form-check-label"],{for:e.name})).innerHTML=e.label,e.mandatory&&((e=a("span",["required-mark"])).textContent=" *",n.appendChild(e)),r.appendChild(n)),t.appendChild(r)}function addRadioGroup(i,e,{createElement:l}){if(i.options){let n=l("fieldset");var t,a;i.label&&((t=l("legend",["form-label"])).innerHTML=i.label,i.mandatory&&((a=l("span",["required-mark"])).textContent=" *",t.appendChild(a)),n.appendChild(t)),i.options.forEach(e=>{var t=l("div",["form-check"]),a=l("input",["form-check-input"],{type:"radio",id:i.name+"_"+e.value,name:i.name,value:e.value||e.label}),r=(i.mandatory&&a.setAttribute("required",!0),l("label",["form-check-label"],{for:i.name+"_"+e.value}));r.textContent=e.label,t.appendChild(a),t.appendChild(r),n.appendChild(t)}),e.appendChild(n)}}function addSubmitButton(e,t,a,{createElement:r}){var n=r("div",["col-12","mt-2"]),i=r("div",["d-grid"]);let l=["btn"];(e.style||"primary").split(" ").filter(Boolean).forEach((e,t)=>{e.startsWith("btn-")?l.push(e):l.push("btn-"+e)});r=r("button",l,{type:"submit",id:e.name});r.textContent=e.label||"Submit",e.action&&a.setAttribute("data-action",e.action),i.appendChild(r),n.appendChild(i),t.appendChild(n)}function setupFormValidation(e,t){e.addEventListener("focusout",e=>{e=e.target;e.matches("input, select, textarea")&&(e.checkValidity()?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(e.value.trim()||e.hasAttribute("required"))&&(e.classList.remove("is-valid"),e.classList.add("is-invalid")))}),e.addEventListener("submit",e=>handleFormSubmit(e,t))}async function handleFormSubmit(t,a){t.preventDefault(),t.stopPropagation();var t=t.target,r=t.querySelector('button[type="submit"]'),e=r.textContent,n="true"===t.getAttribute("data-recaptcha"),i=(t.querySelectorAll(".alert").forEach(e=>e.remove()),validateForm(t));if(0<i.length)showValidationErrors(t,i);else if(t.checkValidity()){i=t.getAttribute("data-action");if(i)try{r.disabled=!0,r.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status"></span>Sending...';let e=null;if(n)try{if(window.grecaptcha||await loadRecaptchaScript(),!(e=await executeRecaptcha("submit_form")))throw new Error("Security verification failed.")}catch(e){throw new Error("Security verification failed. Please refresh the page and try again.")}var l=new FormData(t);l.append("formId",a.formId||"unknown"),l.append("timestamp",(new Date).toJSON()),e&&l.append("recaptchaToken",e),await fetch(i,{method:"POST",mode:"no-cors",body:l}),showSuccessMessage(t),t.reset(),t.classList.remove("was-validated"),t.querySelectorAll(".is-valid, .is-invalid").forEach(e=>{e.classList.remove("is-valid","is-invalid")})}catch(e){console.error("Form submission failed:",e),showSubmissionError(t,e.message)}finally{r.disabled=!1,r.textContent=e}else console.warn("No form action URL specified")}else t.classList.add("was-validated")}function validateForm(e){let a=[];return e.querySelectorAll("[required]").forEach(e=>{var t=e.value.trim();t?"email"!==e.type||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||a.push("Please enter a valid email address."):a.push(`Please enter your ${e.name||"required field"}.`)}),a}function showValidationErrors(e,t){var a=document.createElement("div");a.className="alert alert-danger mt-3 d-flex align-items-start",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="flex-shrink-0 me-2 mt-1" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>'+`<div><strong>Please fix the following:</strong><br>${t.map(e=>"&bull; "+e).join("<br>")}</div>`,e.appendChild(a)}function showSuccessMessage(e){var t=document.createElement("div");t.className="alert alert-success mt-3 d-flex align-items-start",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="flex-shrink-0 me-2 mt-1" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg><div><strong>Thank you!</strong> Your message has been submitted successfully. We will respond within one business day.</div>',e.appendChild(t)}function showSubmissionError(e,t){var a=document.createElement("div");a.className="alert alert-danger mt-3 d-flex align-items-start",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="flex-shrink-0 me-2 mt-1" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>'+`<div><strong>Error:</strong> ${t||"There was an error submitting the form. Please try again."}</div>`,e.appendChild(a)}function loadRecaptchaScript(){return new Promise(e=>{var t;window.grecaptcha&&window.grecaptcha.ready?window.grecaptcha.ready(()=>e()):((t=document.createElement("script")).src="https://www.google.com/recaptcha/api.js?render="+RECAPTCHA_SITE_KEY,t.async=!0,t.defer=!0,t.onload=()=>{window.grecaptcha.ready(()=>e())},document.head.appendChild(t))})}async function executeRecaptcha(e){try{return await window.grecaptcha.execute(RECAPTCHA_SITE_KEY,{action:e})}catch(e){return console.error("reCAPTCHA execution error:",e),null}}