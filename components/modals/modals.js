class ModalSystem{constructor(e){this.activeModal=null,this.modalContainer=null,this.loadingStates=new Map,this.createElement=e.createElement,this.processNestedComponents=e.processNestedComponents,this.getResourceTracker=e.getResourceTracker,this.loadedResources={css:new Set,js:new Set},this.init()}init(){this.initializeLoadedResources(),this.setupEventListeners()}initializeLoadedResources(){var e=this.getResourceTracker();this.loadedResources.css=new Set(e.loadedResources.css),this.loadedResources.js=new Set(e.loadedResources.js)}setupEventListeners(){document.addEventListener("modal:trigger",this.handleModalTrigger.bind(this)),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.activeModal&&this.closeModal()})}async handleModalTrigger(t){var e,{url:t,button:a}=t.detail;try{this.loadingStates.get(t)||(this.loadingStates.set(t,!0),e=await this.loadModalContent(t),await this.showModal(e,t,a))}catch(e){console.error(`Failed to load modal from ${t}:`,e),this.showErrorModal(e.message)}finally{this.loadingStates.delete(t)}}async loadModalContent(e){e=await fetch(e,{headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"}});if(e.ok)return e.text();throw new Error(`HTTP ${e.status}: `+e.statusText)}async showModal(e,t,a){this.activeModal&&this.closeModal();let s=document.querySelector(`.modal[data-url="${t}"]`);s?this.activeModal=s:(s=this.createModalStructure(e,t),document.body.appendChild(s),this.activeModal=s,await this.processNestedComponents(s,["modals"]));e=new bootstrap.Modal(s,{backdrop:!0,keyboard:!0,focus:!1});this.setupModalEventListeners(s,e,a),e.show()}createModalStructure(e,t){var a="modal-"+Date.now(),a=this.createElement("div",["modal","modal-lg","fade"],{id:a,"data-url":t}),t=["modal-dialog"],t=(e.includes("modal-dialog-centered")&&t.push("modal-dialog-centered"),e.includes("modal-dialog-scrollable")&&t.push("modal-dialog-scrollable"),e.includes("modal-xl")?t.push("modal-xl"):e.includes("modal-lg")?t.push("modal-lg"):e.includes("modal-sm")&&t.push("modal-sm"),this.createElement("div",t)),s=this.createElement("div",["modal-content"]),o=this.createElement("div",["modal-body"]);return o.innerHTML=e,s.appendChild(o),t.appendChild(s),a.appendChild(t),a}setupModalEventListeners(t,a,e){t.addEventListener("shown.bs.modal",()=>{requestAnimationFrame(()=>{var e=t.querySelector('input, button, select, textarea, [tabindex]:not([tabindex="-1"])');e&&e.focus()}),t.dispatchEvent(new CustomEvent("modal:shown",{detail:{modal:t,triggerButton:e},bubbles:!0}))}),t.addEventListener("hidden.bs.modal",()=>{e&&document.contains(e)&&e.focus(),this.cleanupModal(t),document.dispatchEvent(new CustomEvent("modal:closed",{detail:{modal:t,triggerButton:e},bubbles:!0}))}),t.addEventListener("click",e=>{e.target===t&&a.hide()})}showErrorModal(e){this.showModal(`
      <div class="alert alert-danger" role="alert">
        <h4 class="alert-heading">Error Loading Modal</h4>
        <p>${e}</p>
        <hr>
        <p class="mb-0">Please try again later or contact support if the problem persists.</p>
      </div>
    `,"error",null)}closeModal(){var e;this.activeModal&&(e=bootstrap.Modal.getInstance(this.activeModal))&&e.hide()}cleanupModal(e){var t;e&&(t=bootstrap.Modal.getInstance(e))&&t.dispose(),this.activeModal===e&&(this.activeModal=null)}async showModalFromUrl(t,e={}){try{var a=await this.loadModalContent(t);await this.showModal(a,t,e.triggerButton||null)}catch(e){console.error(`Failed to show modal from ${t}:`,e),this.showErrorModal(e.message)}}isModalActive(){return null!==this.activeModal}}async function initializeModals(){var{createElement:e,processNestedComponents:t,getResourceTracker:a}=await import("../../../scripts/app.js");new ModalSystem({createElement:e,processNestedComponents:t,getResourceTracker:a})}export default initializeModals;export{ModalSystem};